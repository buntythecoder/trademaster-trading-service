#
# Gatling Configuration for TradeMaster Load Testing
#
# This configuration optimizes Gatling for high-performance load testing
# with Java 24 Virtual Threads and realistic trading platform scenarios.
#

gatling {
  core {
    # Simulation output directory
    outputDirectoryBaseName = "trademaster"
    runDescription = "TradeMaster Load Testing"
    encoding = "utf-8"

    # Simulation execution timeout
    simulationClass = ""

    # Connection pool configuration for Virtual Threads
    connectionPoolSize = 500 # Increased for high concurrency

    # Throttle configuration
    throttle {
      maxRequestsPerSecond = 10000 # Maximum RPS
    }

    # Feeder configuration
    directory {
      data = "src/gatling/resources/data"
      bodies = "src/gatling/resources/bodies"
      binaries = "src/gatling/resources/binaries"
    }
  }

  charting {
    # Disable chart generation for faster reporting
    noReports = false
    maxPlotPerSeries = 1000
    useGroupDurationMetric = false
    indicators {
      lowerBound = 200      # Lower acceptable response time (ms)
      higherBound = 500     # Higher acceptable response time (ms)
      percentile1 = 50      # p50
      percentile2 = 75      # p75
      percentile3 = 95      # p95 - SLA target
      percentile4 = 99      # p99 - SLA target
    }
  }

  http {
    # Enable HTTP/2 support
    enableHttp2 = true

    # Connection configuration
    pooledConnectionIdleTimeout = 60000 # 60 seconds
    requestTimeout = 60000 # 60 seconds timeout per request

    # Advanced connection pooling for high concurrency
    ahc {
      # Maximum connections per host
      maxConnectionsPerHost = 500
      # Connection pool configuration
      pooledConnectionIdleTimeout = 60000
      readTimeout = 60000
      # Disable connection pooling timeout for endurance tests
      connectionTtl = -1
      # Keep-alive for connection reuse
      keepAlive = true
      # Connection timeout
      connectTimeout = 10000
    }

    # DNS configuration
    dns {
      # Cache DNS queries
      queryTimeout = 5000
      maxQueriesPerResolve = 6
    }

    # Request/Response body handling
    request {
      # Maximum body length for logging
      maxCharsInBodyPreview = 1000
    }

    response {
      # Maximum body length for logging
      maxCharsInBodyPreview = 1000
    }

    # SSL configuration
    ssl {
      useInsecureTrustManager = false
      useOpenSsl = false
      # Session configuration for connection reuse
      sessionCacheSize = 20000
      sessionTimeout = 86400
    }
  }

  data {
    writers = [console, file, graphite]

    # Console writer configuration
    console {
      light = false
      writePeriod = 5 # Write statistics every 5 seconds
    }

    # File writer configuration
    file {
      bufferSize = 8192
    }

    # Graphite/InfluxDB integration (optional)
    graphite {
      light = false
      host = "localhost"
      port = 2003
      protocol = "tcp"
      rootPathPrefix = "trademaster.gatling"
      bufferSize = 8192
      writePeriod = 1
    }

    # Leak detection (for debugging)
    leak {
      noActivityTimeout = 30
    }
  }

  jms {
    # JMS is not used in TradeMaster
  }

  recorder {
    # Recorder configuration (not used in automated load testing)
    core {
      mode = "Proxy"
      encoding = "utf-8"
      simulationOutputFolder = "src/test/scala"
      saveConfig = true
    }

    http {
      automaticReferer = true
      followRedirect = true
      inferHtmlResources = true
    }
  }
}
